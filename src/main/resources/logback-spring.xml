<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!-- Define se o mascaramento estÃ¡ ativo -->
    <springProperty scope="context" name="ENABLE_MASKING" source="logging.masking.enabled" defaultValue="true"/>

    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">

            <!-- Mascaramento condicional -->
            <if condition='property("ENABLE_MASKING").equals("true")'>
                <then>
                    <jsonGeneratorDecorator class="net.logstash.logback.mask.MaskingJsonGeneratorDecorator">
                        <defaultMask>***MASKED***</defaultMask>

                        <path>authorization</path>
                        <pathPattern>.*authorization.*</pathPattern>
                        <pathPattern>.*cpf.*</pathPattern>
                        <pathPattern>.*cnpj.*</pathPattern>
                        <pathPattern>.*documento.*</pathPattern>
                        <pathPattern>.*document.*</pathPattern>

                        <valueMask>
                            <value>(?&lt;!\d)(\d{3})\.(\d{3})\.(\d{3})-(\d{2})(?!\d)</value>
                            <mask>$1.***.***-$4</mask>
                        </valueMask>

                        <valueMask>
                            <value>"(?:document|documento|cpf)"\s*:\s*"(\d{3})(\d{6})(\d{2})"</value>
                            <mask>"document":"$1******$3"</mask>
                        </valueMask>

                        <valueMask>
                            <value>(?&lt;!\d)(\d{2})\.(\d{3})\.(\d{3})/(\d{4})-(\d{2})(?!\d)</value>
                            <mask>$1.***.***/****-$5</mask>
                        </valueMask>

                        <valueMask>
                            <value>"(?:document|documento|cnpj)"\s*:\s*"(\d{2})(\d{10})(\d{2})"</value>
                            <mask>"document":"$1**********$3"</mask>
                        </valueMask>
                    </jsonGeneratorDecorator>
                </then>
            </if>

            <includeMdcKeyName>traceId</includeMdcKeyName>
            <timestampPattern>yyyy-MM-dd'T'HH:mm:ss.SSSX</timestampPattern>
        </encoder>
    </appender>

    <root level="INFO">
        <appender-ref ref="CONSOLE" />
    </root>

</configuration>